<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Export AI Assistant - Demo Access</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f3f4f6;
    color: #1f2937;
    margin: 0; padding: 0;
    display: flex; flex-direction: column; align-items: center; min-height: 100vh;
  }
  header {
    background-color: #2563eb;
    color: white;
    width: 100%;
    padding: 1.5rem 0;
    text-align: center;
    font-size: 1.8rem;
  }
  main {
    max-width: 540px;
    margin: 2rem auto;
    background: white;
    padding: 2rem 2.5rem;
    border-radius: 8px;
    box-shadow: 0 6px 15px rgb(0 0 0 / 0.1);
    width: 90%;
  }
  .instructions {
    background: #eff6ff;
    border: 1px solid #2563eb;
    color: #2563eb;
    border-radius: 8px;
    padding: 1rem;
    font-size: 1.08rem;
    margin-bottom: 1.5rem;
    text-align: center;
  }
  label {
    display: block;
    margin-bottom: 0.6rem;
    font-weight: 600;
  }
  input[type="text"] {
    width: 100%;
    padding: 0.6rem 0.8rem;
    font-size: 1rem;
    border: 2px solid #cbd5e1;
    border-radius: 5px;
    margin-bottom: 1.2rem;
    box-sizing: border-box;
  }
  button {
    background-color: #2563eb;
    border: none;
    color: white;
    padding: 0.8rem 2rem;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    border-radius: 6px;
    width: 100%;
    transition: background-color 0.25s ease;
  }
  button:hover {
    background-color: #1d4ed8;
  }
  .message {
    margin-top: 1rem;
    font-size: 0.95rem;
    color: #dc2626;
  }
  .status-message {
    background: #f3f4f6;
    border: 1px solid #2563eb;
    border-radius: 8px;
    padding: 1rem;
    color: #1e293b;
    margin-bottom: 1.3rem;
    font-size: 1.12rem;
    text-align: center;
  }
  .agent-container {
    margin-top: 2rem;
    display: none;
  }
  footer {
    margin-top: auto;
    padding: 1rem;
    font-size: 0.85rem;
    color: #6b7280;
    text-align: center;
  }
</style>
</head>
<body>

<header>Export AI Assistant - Demo Access</header>

<main>

  <div class="instructions">
    Welcome! You’re about to use a special demo version of the Canadian Export AI Assistant.<br>
    Enter your demo code to unlock access.<br>
    You will see your time and allowed questions; when either runs out, you’ll be invited to upgrade.
  </div>

  <div id="code-entry-area">
    <label for="accessCode">Enter Your Demo Access Code:</label>
    <input type="text" id="accessCode" placeholder="Demo Code Here" />
    <button id="validateBtn">Validate Code</button>
    <div class="message" id="message"></div>
  </div>

  <div class="agent-container" id="agentArea">
    <div class="status-message" id="statusMessage">
      <!-- Updated by JS -->
      Demo access granted!<br>
      <span id="statusTime"></span> &nbsp;|&nbsp; <span id="statusQuestions"></span>
    </div>
    <!-- ElevenLabs agent widget embed - put your real agent-id below -->
    <elevenlabs-convai agent-id="agent_1301kacqfhgjftpaan3a91vxm8kk"></elevenlabs-convai>
    <script src="https://unpkg.com/@elevenlabs/convai-widget-embed" async defer></script>
  </div>
</main>

<footer>
  © 2025 Canadian Export AI Assistant | SinghLabs
</footer>

<script>
const demoCodes = {
  "ADAM2025": { interactions: 12, minutes: 10 },
  "ABDULVIP": { interactions: 8, minutes: 10 },
  "ANDYTRIAL": { interactions: 10, minutes: 10 },
  "CEDGROWTH": { interactions: 7, minutes: 10 }
};

let activeCode = '';
let interactionsLeft = 0;
let minutesLeft = 0;
let secondsLeft = 0;
let timerInterval;
let interactionsUsed = 0;
let autoDecrementInterval;

const accessCodeInput = document.getElementById("accessCode");
const validateBtn = document.getElementById("validateBtn");
const messageDiv = document.getElementById("message");
const agentArea = document.getElementById("agentArea");
const codeEntryArea = document.getElementById("code-entry-area");
const statusMessage = document.getElementById("statusMessage");
const statusTime = document.getElementById("statusTime");
const statusQuestions = document.getElementById("statusQuestions");

function loadUsage(code) {
  const use = JSON.parse(localStorage.getItem("agent_usage_" + code));
  if (use && typeof use.interactions === 'number' && typeof use.minutes === 'number') {
    interactionsLeft = use.interactions;
    minutesLeft = use.minutes;
    interactionsUsed = use.totalUsed || 0;
  } else {
    interactionsLeft = demoCodes[code].interactions;
    minutesLeft = demoCodes[code].minutes;
    interactionsUsed = 0;
  }
  secondsLeft = 0;
}

function saveUsage(code) {
  localStorage.setItem(
    "agent_usage_" + code,
    JSON.stringify({
      interactions: interactionsLeft,
      minutes: minutesLeft,
      totalUsed: interactionsUsed
    })
  );
}

function updateStatusMessage() {
  let min = minutesLeft > 0 ? minutesLeft : 0;
  let sec = secondsLeft > 0 ? secondsLeft : 0;
  if (sec < 10) sec = '0' + sec;
  let timeText = "Time remaining: <strong>" + min + ":" + sec + "</strong> minutes";
  let questionsText = "Questions remaining: <strong>" + interactionsLeft + "</strong>";
  statusTime.innerHTML = timeText;
  statusQuestions.innerHTML = questionsText;
}

function startTimerAndAutoDecrement() {
  updateStatusMessage();

  timerInterval = setInterval(() => {
    if (secondsLeft === 0) {
      if (minutesLeft === 0) {
        clearInterval(timerInterval);
        clearInterval(autoDecrementInterval);
        updateStatusMessage();
        alert("Your demo session has ended due to time limit.");
        lockOutUser("Time limit reached. Please contact us to upgrade.");
        return;
      } else {
        minutesLeft -= 1;
        secondsLeft = 59;
      }
    } else {
      secondsLeft -= 1;
    }
    updateStatusMessage();
    saveUsage(activeCode);
  }, 1000);

  autoDecrementInterval = setInterval(() => {
    if (agentArea.style.display === "block" && interactionsLeft > 0) {
      decreaseInteraction();
    }
  }, 30000); // Every 30 seconds
}

function decreaseInteraction() {
  if (interactionsLeft > 0) {
    interactionsLeft -= 1;
    interactionsUsed += 1;
    updateStatusMessage();
    saveUsage(activeCode);
    if (interactionsLeft === 0) {
      clearInterval(autoDecrementInterval);
      alert("Your demo session has ended due to interaction limit.");
      lockOutUser("Interaction limit reached. Please contact us to upgrade.");
    }
  }
}

function lockOutUser(reason) {
  agentArea.style.display = "none";
  messageDiv.style.color = "#dc2626";
  messageDiv.textContent = reason;
  codeEntryArea.style.display = "block";
  clearInterval(timerInterval);
  clearInterval(autoDecrementInterval);
}

validateBtn.addEventListener("click", () => {
  const code = accessCodeInput.value.trim().toUpperCase();
  if (!code) {
    messageDiv.textContent = "Please enter a demo access code.";
    messageDiv.style.color = "#dc2626";
    return;
  }
  if (demoCodes[code]) {
    activeCode = code;
    loadUsage(code);
    if (interactionsLeft === 0 || minutesLeft === 0) {
      lockOutUser("Your demo period has expired. Please contact us to upgrade.");
      return;
    }
    codeEntryArea.style.display = "none";
    agentArea.style.display = "block";
    messageDiv.textContent = "";
    updateStatusMessage();
    startTimerAndAutoDecrement();
  } else {
    messageDiv.textContent = "Invalid demo code. Please try again or contact support.";
    messageDiv.style.color = "#dc2626";
  }
});

window.addEventListener("DOMContentLoaded", () => {
  for (let code in demoCodes) {
    if (localStorage.getItem("agent_usage_" + code)) {
      activeCode = code;
      loadUsage(code);
      if (interactionsLeft > 0 && minutesLeft > 0) {
        codeEntryArea.style.display = "none";
        agentArea.style.display = "block";
        updateStatusMessage();
        startTimerAndAutoDecrement();
      }
      break;
    }
  }
});
</script>

</body>
</html>
